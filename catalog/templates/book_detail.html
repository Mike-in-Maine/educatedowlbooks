{% extends "main/base.html" %}
{% load static %}

{% block title %}{{ book.title }} | Educated Owl Books{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/book_detail.css' %}">

<div class="book-container">

    <!-- LEFT: COVER -->
    <div class="book-cover">
        {% if book.cover_image %}
            <img src="{{ book.cover_image.url }}" alt="{{ book.title }}">
        {% else %}
            <div class="no-cover">No Cover Image</div>
        {% endif %}

        {% if book.isbn10 %}
        <a
            href="https://camelcamelcamel.com/product/{{ book.isbn10 }}"
            target="_blank"
            class="btn-secondary full-width"
        >
            üìâ View Price History
        </a>
        {% endif %}
    </div>

    <!-- RIGHT: INFO -->
    <div class="book-info">

        <h1 class="book-title">{{ book.title }}</h1>
        <p class="book-author">by <strong>{{ book.author }}</strong></p>

        <!-- Social proof -->
        <div class="book-meta-stats">
            <span class="stat-badge stat-rating">‚≠ê {{ book.rating_avg|default:"0.0" }}</span>
            <span class="stat-badge stat-want">üìñ {{ book.want_to_read_count }} Want to Read</span>
            <span class="stat-badge stat-read">‚úÖ {{ book.already_read_count }} Read</span>
        </div>

        <!-- AVAILABLE COPIES -->
        {% if listings %}
        <section class="available-copies">
            <h2 class="section-title">Available Copies</h2>

            <table class="copies-table">
                <thead>
                    <tr>
                        <th>Seller</th>
                        <th>Format</th>
                        <th>Condition</th>
                        <th class="price-col">Price</th>
                    </tr>
                </thead>
                <tbody>
                {% for listing in listings %}
                    <tr>
                        <td>
                            <strong>{{ listing.seller.display_name }}</strong><br>
                            <span class="stock">
                                {% if listing.quantity > 1 %}
                                    {{ listing.quantity }} available
                                {% else %}
                                    In stock
                                {% endif %}
                            </span>
                        </td>

                        <td>
                            {% if listing.format %}
                                {{ listing.get_format_display }}
                            {% else %}
                                ‚Äî
                            {% endif %}
                        </td>

                        <td>{{ listing.get_condition_display }}</td>

                        <td class="price-cell">
                            ${{ listing.price }}
                            <div class="cart-placeholder">
                                <button disabled>Add to cart</button>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </section>
        {% endif %}

        <!-- DESCRIPTION -->
        <section class="book-description">
            <h2 class="section-title">Description</h2>
            <p>{{ book.description|default:"No description available for this edition." }}</p>
        </section>

        <!-- METADATA -->
        <table class="meta-table">
            <tr><th>ISBN-10</th><td>{{ book.isbn10 }}</td></tr>
            {% if book.amazon_asin %}
                <tr><th>Amazon ASIN</th><td>{{ book.amazon_asin }}</td></tr>
            {% endif %}
            <tr><th>Publisher</th><td>{{ book.publisher }} ({{ book.publication_year }})</td></tr>
            <tr><th>Pages</th><td>{{ book.pages|default:"Unknown" }}</td></tr>
            <tr><th>Language</th><td>{{ book.language }}</td></tr>
        </table>

        {% if book.preview_url %}
        <a href="{{ book.preview_url }}" target="_blank" class="btn-secondary">
            üìñ Read Preview
        </a>
        {% endif %}

    </div>
</div>
{% endblock %}
