{% extends "main/base.html" %}
{% load static %}

{% block title %}{{ book.title }} | Educated Owl Books{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/book_detail.css' %}">

<div class="book-container">

    <!-- LEFT COLUMN: BOOK INFO -->
    <div class="book-info">

        <h1 class="book-title">{{ book.title }}</h1>
        <p class="book-author">by <strong>{{ book.author }}</strong></p>

        <div class="book-meta-stats">
            <span class="stat-badge">‚≠ê {{ book.rating_avg|default:"‚Äî" }}</span>
            <span class="stat-badge">üìñ {{ book.want_to_read_count }} Want to Read</span>
            <span class="stat-badge">‚úÖ {{ book.already_read_count }} Read</span>
        </div>

        {% if book.cover_image %}
            <img
                src="{{ book.cover_image.url }}"
                alt="{{ book.title }}"
                style="max-width:180px; margin: 1rem 0;"
            >
        {% endif %}

        <section class="book-description">
            <h2>Description</h2>
            <p>{{ book.description|default:"No description available." }}</p>
        </section>

        <table class="meta-table">
            <tr><th>ISBN-10</th><td>{{ book.isbn10 }}</td></tr>
            <tr><th>ISBN-13</th><td>{{ book.isbn13 }}</td></tr>
            <tr><th>Publisher</th><td>{{ book.publisher }} ({{ book.publication_year }})</td></tr>
            <tr><th>Pages</th><td>{{ book.pages|default:"‚Äî" }}</td></tr>
            <tr><th>Language</th><td>{{ book.language }}</td></tr>
        </table>

    </div>

    <!-- RIGHT COLUMN: PRIMARY OFFER -->
    <aside class="primary-offer">

        {% if primary_listing %}
        <div class="primary-price-title">  
            Lowest-Priced Available Copy 
        </div>

            <div class="primary-price">
                ${{ primary_listing.price }}
            </div>

            <div class="primary-meta">
                <strong>{{ primary_listing.get_condition_display }}</strong><br>
                {% if primary_listing.format %}
                    {{ primary_listing.get_format_display }}<br>
                {% endif %}
                Sold by {{ primary_listing.seller.display_name }}
                {% if primary_listing.seller.country %}
                    <br><span class="seller-country">
                        Ships from {{ primary_listing.seller.country }}
                    </span>
                {% endif %}
                <p class="seller-policy-note">
                    Orders are fulfilled directly by the seller.  
                    Returns and refunds follow the seller‚Äôs stated policy.
                </p>

            </div>

            <div class="primary-stock">
                {% if primary_listing.quantity > 1 %}
                    {{ primary_listing.quantity }} available
                {% else %}
                    In stock
                {% endif %}
            </div>

            <button class="btn-primary" disabled>
                Add to cart
            </button>
        {% else %}
            <p>No copies currently available.</p>
        {% endif %}

    </aside>

</div>

<!-- OTHER SELLERS -->
{% if other_listings %}
<section class="other-offers">

    <h2>Other Sellers Offering This Book</h2>

    <table class="copies-table">
        <thead>
            <tr>
                <th>Seller</th>
                <th>Format</th>
                <th>Condition</th>
                <th class="price-col">Price</th>
            </tr>
        </thead>
        <tbody>
        {% for listing in other_listings %}
            <tr>
                <td>{{ listing.seller.display_name }}</td>
                <td>{{ listing.get_format_display|default:"‚Äî" }}</td>
                <td>{{ listing.get_condition_display }}</td>
                <td>${{ listing.price }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

</section>
{% endif %}

{% endblock %}
